# Copilot Instructions for TL40-Dots

- **What this repo is**: Arch-centric dotfiles and automation to bootstrap a workstation: install packages, symlink configs, restore desktop shortcuts, and optionally configure YubiKey PAM.
- **Primary entrypoint**: `bash install.sh` runs interactively, using [install.sh](../install.sh) to offer steps (package installs, symlinks, shortcuts, Flatpaks, YubiKey). It sources [scripts/lib/detect-os.sh](../scripts/lib/detect-os.sh) but currently assumes pacman/paru flows; it still references `base-tools.sh`/`desktop-packages.sh` which are missing—swap to [scripts/pkg-scripts/cli-packages.sh](../scripts/pkg-scripts/cli-packages.sh) and [scripts/pkg-scripts/gui-packages.sh](../scripts/pkg-scripts/gui-packages.sh) before using.
- **Package installation (Arch/paru)**: [scripts/pkg-scripts/cli-packages.sh](../scripts/pkg-scripts/cli-packages.sh) installs a large CLI stack via pacman and then paru AUR; run [scripts/pkg-scripts/paru-install.sh](../scripts/pkg-scripts/paru-install.sh) first if paru is absent. [scripts/pkg-scripts/gui-packages.sh](../scripts/pkg-scripts/gui-packages.sh) installs desktop apps with basic conflict guards (obs-studio vs obs-studio-stable, dotnet-sdk-bin). [scripts/pkg-scripts/podman-postinstall.sh](../scripts/pkg-scripts/podman-postinstall.sh) enables podman sockets (systemd/OpenRC) and supports `--user`. [scripts/pkg-scripts/homebrew-install.sh](../scripts/pkg-scripts/homebrew-install.sh) installs Homebrew and appends `brew shellenv` to both bash and fish configs.
- **Flatpaks**: [scripts/pkg-scripts/flatpak-restore.sh](../scripts/pkg-scripts/flatpak-restore.sh) is a generated list of `flatpak remote-add`/`flatpak install` commands (duplicates flathub add) with no dry-run or pruning; run manually when Flatpak is available.
- **Dotfile linking**: [scripts/postinstall/dotfile-symlinks.sh](../scripts/postinstall/dotfile-symlinks.sh) uses GNU Stow from config/ into `$XDG_CONFIG_HOME`, first deleting existing dirs/files (atuin, fastfetch, fish, ghostty, starship.toml). It skips kde/containers/clamav/aichat/system.yaml, then symlinks starship.toml explicitly and copies config/aichat/config.yaml. KDE configs link only if plasmashell/plasma-desktop exists; ClamAV configs link into /etc/clamav via sudo. [scripts/postinstall/nas-symlinks.sh](../scripts/postinstall/nas-symlinks.sh) force-links /mnt/nas paths into home directories—ensure mounts exist.
- **Desktop shortcuts**: [scripts/desktop/gnome/restore-gnome-shortcuts.sh](../scripts/desktop/gnome/restore-gnome-shortcuts.sh) sets GNOME media-key custom bindings, supports `--dry-run`, `--no-backup`, `--prune-missing`, and writes backups under output/. Commands referenced (guake, code, ghostty, signal-desktop, etc.) must exist or will be warned/pruned.
- **YubiKey PAM**: [scripts/system-setup/yk-pam.sh](../scripts/system-setup/yk-pam.sh) must run as root; installs pam-u2f if missing, writes `u2f_keys` under `~/.config/yubico` for `SUDO_USER`, injects `auth sufficient pam_u2f.so ...` into multiple PAM stacks, and enables pcscd. Warn users about lockout risk if pam_u2f is absent.
- **Logging/color helpers**: [scripts/lib/pretty-output.sh](../scripts/lib/pretty-output.sh) centralizes INFO/ERROR symbols and ANSI colors used by installers; keep in sync if adding steps to [install.sh](../install.sh).
- **Upstream/vendor content**: [config/containers](../config/containers) holds upstream compose assets and docs (e.g., glance README) that act as references rather than managed code.
- **General expectations**: Scripts favor `/usr/bin/env bash`, `set -e`/pipefail, and idempotent reruns. Package installers are Arch-first (pacman/paru names); if extending to other distros, guard pacman usage or add per-distro branches.
